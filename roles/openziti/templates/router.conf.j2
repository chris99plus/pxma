v: 3

identity:
  cert:             "{{ openziti_router_home }}/{{ openziti_router_name }}.cert"
  server_cert:      "{{ openziti_router_home }}/{{ openziti_router_name }}.server.chain.cert"
  key:              "{{ openziti_router_home }}/{{ openziti_router_name }}.key"
  ca:               "{{ openziti_router_home }}/{{ openziti_router_name }}.cas"

ctrl:
  endpoint:             tls:{{ openziti_ctrl_advertised_address }}:{{ openziti_ctrl_advertised_port }}

link:
{% if openziti_router_link_dialer_enabled %}
  dialers:
    - binding: transport
      groups: {{ openziti_router_groups }}
{%- endif %}

{% if openziti_router_link_listener_enabled %}
  listeners:
    - binding:          transport
      bind:             tls:0.0.0.0:{{ openziti_router_bind_port }}
      advertise:        tls:{{ openziti_router_advertised_address }}:{{ openziti_router_bind_port }}
      groups: {{ openziti_router_groups }}
      options:
        outQueueSize:   4
{%- endif %}

listeners:
  - binding: edge
    address: tls:0.0.0.0:{{ openziti_router_port }}
    options:
      advertise: {{ openziti_router_advertised_address }}:{{ openziti_router_port }}
      connectTimeoutMs: 5000
      getSessionTimeout: 60

{% if openziti_router_tunnel_enabled %}
  - binding: tunnel
    options:
      mode: {{ openziti_router_mode }}
{% endif %}

edge:
  csr:
    country: {{ openziti_pki_country }}
    province: {{ openziti_pki_province }}
    locality: {{ openziti_pki_locality }}
    organization: {{ openziti_pki_organisation }}
    organizationalUnit: {{ openziti_pki_organisational_unit }}
    sans:
      dns:
        - localhost
        {% if not (openziti_router_advertised_address | ansible.utils.ipaddr) -%}
        - {{ openziti_router_advertised_address }}
        {%- endif%}

      ip:
        - "127.0.0.1"
        - "::1"
        {% if (openziti_router_advertised_address | ansible.utils.ipaddr) -%}
        - "{{ openziti_router_advertised_address }}"
        {%- endif %}


forwarder:
  latencyProbeInterval: 0
  xgressDialQueueLength: 1000
  xgressDialWorkerCount: 128
  linkDialQueueLength: 1000
  linkDialWorkerCount: 32

